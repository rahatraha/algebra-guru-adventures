import { useParams } from "react-router-dom";
import Navbar from "../components/layout/Navbar";
import { Card, CardContent } from "@/components/ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Button } from "@/components/ui/button";
import { CheckCircle2 } from "lucide-react";

interface TopicContent {
  theory: string;
  examples: Array<{
    problem: string;
    solution: string;
  }>;
  exercises: Array<{
    problem: string;
    answer: string;
  }>;
}

const topics: Record<string, Record<string, Record<number, TopicContent>>> = {
  chemistry: {
    "8": {
      0: {
        theory: `
          <h2>Первоначальные химические понятия</h2>
          <p>Химия - наука о веществах, их свойствах и превращениях.</p>
          <p>Основные понятия:</p>
          <ul>
            <li>Атом - мельчайшая частица химического элемента</li>
            <li>Молекула - наименьшая частица вещества</li>
            <li>Вещество - то, из чего состоят физические тела</li>
          </ul>
          <p>Химические явления (реакции):</p>
          <ul>
            <li>Выделение газа</li>
            <li>Изменение цвета</li>
            <li>Выпадение осадка</li>
            <li>Изменение температуры</li>
          </ul>
          <p>Физические явления:</p>
          <ul>
            <li>Изменение агрегатного состояния</li>
            <li>Изменение формы</li>
            <li>Деформация</li>
          </ul>
        `,
        examples: [
          {
            problem: "Определите тип вещества: вода (H₂O)",
            solution: "Вода - сложное вещество, состоит из атомов водорода (H) и кислорода (O). В молекуле воды 2 атома водорода и 1 атом кислорода."
          },
          {
            problem: "Определите тип явления: растворение сахара в воде",
            solution: "Это физическое явление, так как:\n1. Не образуется новое вещество\n2. Сахар можно выделить выпариванием воды\n3. Изменяется только агрегатное состояние сахара"
          }
        ],
        exercises: [
          {
            problem: "Классифицируйте вещества: O₂, NaCl, Fe, H₂O",
            answer: "O₂ - простое вещество (состоит из атомов одного элемента)\nNaCl - сложное вещество (состоит из атомов разных элементов)\nFe - простое вещество (состоит из атомов одного элемента)\nH₂O - сложное вещество (состоит из атомов разных элементов)"
          },
          {
            problem: "Определите тип явлений:\n1. Горение свечи\n2. Таяние льда\n3. Ржавление железа",
            answer: "1. Горение свечи - химическое явление (образуются новые вещества: CO₂ и H₂O)\n2. Таяние льда - физическое явление (изменяется только агрегатное состояние)\n3. Ржавление железа - химическое явление (образуется новое вещество - оксид железа Fe₂O₃)"
          }
        ]
      },
      1: {
        theory: `
          <h2>Кислород. Оксиды. Горение</h2>
          <p>Кислород:</p>
          <ul>
            <li>Химический символ - O</li>
            <li>Относительная атомная масса - 16</li>
            <li>Газ без цвета и запаха</li>
            <li>Плохо растворим в воде</li>
            <li>Поддерживает горение</li>
          </ul>
          <p>Оксиды - бинарные соединения элементов с кислородом:</p>
          <ul>
            <li>Основные (Na₂O, CaO)</li>
            <li>Кислотные (CO₂, SO₃)</li>
            <li>Амфотерные (Al₂O₃, ZnO)</li>
          </ul>
          <p>Горение - химическая реакция соединения веществ с кислородом, протекающая с выделением света и тепла.</p>
        `,
        examples: [
          {
            problem: "Напишите уравнение реакции горения магния",
            solution: "2Mg + O₂ = 2MgO\nМагний сгорает с образованием оксида магния. При горении наблюдается яркая вспышка."
          },
          {
            problem: "Классифицируйте оксид: SO₂",
            solution: "SO₂ (оксид серы (IV)) - кислотный оксид, так как:\n1. Образован неметаллом\n2. При взаимодействии с водой образует кислоту H₂SO₃"
          }
        ],
        exercises: [
          {
            problem: "Составьте уравнения реакций горения:\nа) алюминия\nб) серы\nв) метана (CH₄)",
            answer: "а) 4Al + 3O₂ = 2Al₂O₃\nб) S + O₂ = SO₂\nв) CH₄ + 2O₂ = CO₂ + 2H₂O"
          },
          {
            problem: "Классифицируйте оксиды: Na₂O, CO₂, ZnO, CaO, P₂O₅",
            answer: "Na₂O - основной оксид (образован активным металлом)\nCO₂ - кислотный оксид (образован неметаллом)\nZnO - амфотерный оксид\nCaO - основной оксид (образован щелочноземельным металлом)\nP₂O₅ - кислотный оксид (образован неметаллом)"
          }
        ]
      },
      2: {
        theory: `
          <h2>Водород. Кислоты. Соли</h2>
          <p>Водород:</p>
          <ul>
            <li>Химический символ - H</li>
            <li>Относительная атомная масса - 1</li>
            <li>Самый лёгкий газ</li>
            <li>Без цвета и запаха</li>
            <li>Малорастворим в воде</li>
          </ul>
          <p>Кислоты - сложные вещества, содержащие атомы водорода, способные замещаться атомами металла:</p>
          <ul>
            <li>Бескислородные (HCl, H₂S)</li>
            <li>Кислородсодержащие (H₂SO₄, HNO₃)</li>
          </ul>
          <p>Соли - продукты замещения атомов водорода в кислотах атомами металла:</p>
          <ul>
            <li>Средние (NaCl, CaSO₄)</li>
            <li>Кислые (NaHCO₃)</li>
            <li>Основные (Cu(OH)Cl)</li>
          </ul>
        `,
        examples: [
          {
            problem: "Получение водорода в лаборатории",
            solution: "Zn + 2HCl = ZnCl₂ + H₂↑\nПри взаимодействии цинка с соляной кислотой выделяется водород. Его можно собирать методом вытеснения воздуха или воды."
          },
          {
            problem: "Определите тип соли: Na₂CO₃",
            solution: "Na₂CO₃ (карбонат натрия) - средняя соль, так как:\n1. Все атомы водорода в кислоте H₂CO₃ замещены на атомы натрия\n2. Не содержит ни гидроксогрупп, ни атомов водорода от кислоты"
          }
        ],
        exercises: [
          {
            problem: "Составьте уравнения реакций получения солей:\nа) хлорида меди (II)\nб) сульфата цинка",
            answer: "а) Cu + 2HCl = CuCl₂ + H₂↑\nб) Zn + H₂SO₄ = ZnSO₄ + H₂↑"
          },
          {
            problem: "Классифицируйте соли: NaCl, KHSO₄, Cu(OH)Cl, K₂SO₄",
            answer: "NaCl - средняя соль\nKHSO₄ - кислая соль (содержит атом водорода от кислоты)\nCu(OH)Cl - основная соль (содержит гидроксогруппу)\nK₂SO₄ - средняя соль"
          }
        ]
      }
    },
    "9": {
      0: {
        theory: `
          <h2>Электролитическая диссоциация</h2>
          <p>Электролитическая диссоциация - распад электролита на ионы при растворении в воде или расплавлении.</p>
          <p>Электролиты:</p>
          <ul>
            <li>Сильные (HCl, H₂SO₄, NaOH)</li>
            <li>Слабые (H₂CO₃, NH₄OH)</li>
            <li>Средние (CH₃COOH)</li>
          </ul>
          <p>Степень диссоциации:</p>
          <ul>
            <li>α = n(распавш.)/n(общее) × 100%</li>
            <li>Сильные: α > 30%</li>
            <li>Слабые: α < 3%</li>
          </ul>
        `,
        examples: [
          {
            problem: "Напишите уравнение диссоциации сульфата меди (II)",
            solution: "CuSO₄ = Cu²⁺ + SO₄²⁻\nПри растворении сульфата меди (II) в воде образуются катионы меди Cu²⁺ и анионы SO₄²⁻"
          },
          {
            problem: "Рассчитайте степень диссоциации уксусной кислоты, если из 200 молекул распалось 3",
            solution: "α = (3/200) × 100% = 1.5%\nУксусная кислота - слабый электролит (α < 3%)"
          }
        ],
        exercises: [
          {
            problem: "Напишите уравнения диссоциации:\nа) NaOH\nб) H₂SO₄\nв) Ca(OH)₂",
            answer: "а) NaOH = Na⁺ + OH⁻\nб) H₂SO₄ = 2H⁺ + SO₄²⁻\nв) Ca(OH)₂ = Ca²⁺ + 2OH⁻"
          },
          {
            problem: "Определите сильные и слабые электролиты: HCl, H₂S, KOH, H₂CO₃",
            answer: "Сильные электролиты: HCl, KOH\nСлабые электролиты: H₂S, H₂CO₃"
          }
        ]
      }
    }
  },
  literature: {
    "5": {
      0: {
        theory: `
          <h2>Устное народное творчество</h2>
          <p>Фольклор - устное народное творчество, создаваемое народом и бытующее в народных массах.</p>
          <p>Виды фольклора:</p>
          <ul>
            <li>Сказки (волшебные, бытовые, о животных)</li>
            <li>Былины (киевский цикл, новгородский цикл)</li>
            <li>Пословицы и поговорки</li>
            <li>Загадки</li>
            <li>Песни (обрядовые, лирические)</li>
          </ul>
          <p>Особенности фольклора:</p>
          <ul>
            <li>Устная форма передачи</li>
            <li>Коллективное авторство</li>
            <li>Вариативность</li>
            <li>Традиционность</li>
          </ul>
        `,
        examples: [
          {
            problem: "Определите жанр: 'Не красна изба углами, а красна пирогами'",
            solution: "Это пословица. Признаки:\n1. Краткость\n2. Поучительный смысл\n3. Ритмичность\n4. Часто используется противопоставление"
          },
          {
            problem: "Найдите постоянные эпитеты в отрывке: 'По чисту полю, по зеленой траве бежит добрый молодец'",
            solution: "Постоянные эпитеты:\n1. чисто поле\n2. зеленая трава\n3. добрый молодец\nЭти определения традиционно используются в фольклоре"
          }
        ],
        exercises: [
          {
            problem: "Определите виды сказок:\n1. 'Колобок'\n2. 'Морозко'\n3. 'Каша из топора'",
            answer: "1. 'Колобок' - сказка о животных\n2. 'Морозко' - волшебная сказка\n3. 'Каша из топора' - бытовая сказка"
          },
          {
            problem: "Найдите общие черты былин и волшебных сказок",
            answer: "Общие черты:\n1. Фантастический элемент\n2. Троекратные повторы\n3. Постоянные эпитеты\n4. Героический характер\n5. Борьба добра со злом"
          }
        ]
      },
      1: {
        theory: `
          <h2>Русские народные сказки</h2>
          <p>Сказка - один из основных жанров фольклора, эпическое произведение с установкой на вымысел.</p>
          <p>Виды сказок:</p>
          <ul>
            <li>Волшебные ("Царевна-лягушка", "Василиса Прекрасная")</li>
            <li>Бытовые ("Каша из топора", "Солдатская шинель")</li>
            <li>О животных ("Колобок", "Теремок")</li>
          </ul>
          <p>Особенности сказок:</p>
          <ul>
            <li>Зачин ("Жили-были...")</li>
            <li>Троекратные повторы</li>
            <li>Постоянные эпитеты</li>
            <li>Волшебные предметы и помощники</li>
            <li>Счастливый конец</li>
          </ul>
        `,
        examples: [
          {
            problem: "Найдите элементы волшебной сказки в произведении 'Царевна-лягушка'",
            solution: "1. Волшебное превращение (лягушка → царевна)\n2. Волшебные помощники (стрела, ковёр-самолёт)\n3. Троекратные испытания (три задания от царя)\n4. Волшебные противники (Кощей Бессмертный)"
          },
          {
            problem: "Определите особенности бытовой сказки 'Каша из топора'",
            solution: "1. Главный герой - находчивый солдат\n2. Бытовой сюжет (приготовление каши)\n3. Социальная мораль (осуждение жадности)\n4. Отсутствие волшебства"
          }
        ],
        exercises: [
          {
            problem: "Сравните сказки 'Теремок' и 'Зимовье зверей'. Что общего и в чём различия?",
            answer: "Общее:\n1. Сказки о животных\n2. Тема дружбы и взаимопомощи\n3. Диалоги животных\n\nРазличия:\n1. В 'Теремке' дом уже построен, в 'Зимовье' звери строят дом\n2. Разные финалы (теремок разрушен / звери побеждают волков)\n3. Разное количество персонажей"
          },
          {
            problem: "Определите роль числа 'три' в русских народных сказках",
            answer: "Роль числа 'три':\n1. Три сына/дочери у царя\n2. Три испытания героя\n3. Три дня на выполнение задания\n4. Три волшебных предмета\n5. Символ магической силы"
          }
        ]
      }
    },
    "6": {
      "0": {
        theory: `
          <h2>Мифы народов мира</h2>
          <p>Миф - сказание, передающее представления древних народов о происхождении мира, явлениях природы, богах и героях.</p>
          <p>Виды мифов:</p>
          <ul>
            <li>Космогонические (о создании мира)</li>
            <li>Антропогонические (о происхождении человека)</li>
            <li>Героические (о подвигах героев)</li>
            <li>Календарные (о смене времён года)</li>
          </ul>
        `,
        examples: [
          {
            problem: "Определите вид мифа: 'Дедал и Икар'",
            solution: "Это героический миф, рассказывающий о подвиге человека, бросившего вызов богам и природе. Основные элементы:\n1. Герои-люди\n2. Конфликт с богами\n3. Трагический финал"
          }
        ],
        exercises: [
          {
            problem: "Сравните греческий миф о Прометее и карельский миф о Вяйнямёйнене",
            answer: "Общие черты:\n1. Герои помогают людям\n2. Противостояние высшим силам\n3. Тема творения\n\nРазличия:\n1. Разные способы помощи людям\n2. Разная судьба героев\n3. Различное отношение богов"
          }
        ]
      }
    }
  },
  mathematics: {
    "5": {
      "0": {
        theory: `
          <h2>Натуральные числа</h2>
          <p>Натуральные числа - числа, используемые для счёта предметов.</p>
          <p>Свойства натуральных чисел:</p>
          <ul>
            <li>Каждое натуральное число имеет следующее за ним число</li>
            <li>Любые два натуральных числа можно сравнить</li>
            <li>Натуральные числа можно складывать, вычитать, умножать и делить</li>
          </ul>
        `,
        examples: [
          {
            problem: "Найдите НОД чисел 18 и 24",
            solution: "1. Разложим 18 = 2 × 3 × 3\n2. Разложим 24 = 2 × 2 × 2 × 3\n3. Общие множители: 2 и 3\n4. НОД(18, 24) = 6"
          }
        ],
        exercises: [
          {
            problem: "Решите уравнение: x + 15 = 28",
            answer: "1. x + 15 = 28\n2. x = 28 - 15\n3. x = 13"
          }
        ]
      }
    }
  },
  physics: {
    "7": {
      "0": {
        theory: `
          <h2>Механическое движение</h2>
          <p>Механическое движение - изменение положения тела в пространстве относительно других тел с течением времени.</p>
          <p>Виды движения:</p>
          <ul>
            <li>Прямолинейное</li>
            <li>Криволинейное</li>
            <li>Равномерное</li>
            <li>Неравномерное</li>
          </ul>
        `,
        examples: [
          {
            problem: "Найдите скорость велосипедиста, если он проехал 120 метров за 30 секунд",
            solution: "1. Используем формулу v = s/t\n2. v = 120 м / 30 с\n3. v = 4 м/с"
          }
        ],
        exercises: [
          {
            problem: "Автомобиль движется со скоростью 72 км/ч. Выразите скорость в м/с",
            answer: "1. 72 км/ч = 72 × 1000 м / 3600 с\n2. = 72000/3600\n3. = 20 м/с"
          }
        ]
      }
    }
  },
  biology: {
    "6": {
      "0": {
        theory: `
          <h2>Строение клетки</h2>
          <p>Клетка - основная структурная и функциональная единица всех живых организмов.</p>
          <p>Основные органоиды клетки:</p>
          <ul>
            <li>Ядро - хранит генетическую информацию</li>
            <li>Цитоплазма - внутренняя среда клетки</li>
            <li>Митохондрии - энергетические станции</li>
            <li>Рибосомы - синтез белка</li>
          </ul>
        `,
        examples: [
          {
            problem: "Сравните растительную и животную клетки",
            solution: "Различия:\n1. Клеточная стенка (есть у растений)\n2. Хлоропласты (есть у растений)\n3. Вакуоли (крупнее у растений)\n4. Форма (более правильная у растений)"
          }
        ],
        exercises: [
          {
            problem: "Назовите функции органоидов клетки",
            answer: "1. Ядро - хранение и передача наследственной информации\n2. Митохондрии - синтез АТФ\n3. Рибосомы - синтез белка\n4. Клеточная мембрана - транспорт веществ"
          }
        ]
      }
    }
  },
  geography: {
    "5": {
      0: {
        theory: `
          <h2>Введение в географию</h2>
          <p>География - наука о Земле, её природе, населении и его хозяйственной деятельности.</p>
          <p>Основные разделы географии:</p>
          <ul>
            <li>Физическая география</li>
            <li>Экономическая география</li>
            <li>Социальная география</li>
            <li>Картография</li>
          </ul>
        `,
        examples: [
          {
            problem: "Определите стороны горизонта по компасу",
            solution: "1. Положите компас на ровную поверхность\n2. Дождитесь, пока стрелка остановится\n3. Северный конец стрелки укажет на север\n4. Определите остальные стороны горизонта"
          }
        ],
        exercises: [
          {
            problem: "Назовите основные способы изучения Земли",
            answer: "1. Полевые исследования\n2. Картографический метод\n3. Космическая съёмка\n4. Статистический метод"
          }
        ]
      },
      1: {
        theory: `
          <h2>План местности</h2>
          <p>План местности - чертёж небольшого участка земной поверхности.</p>
          <p>Масштаб:</p>
          <ul>
            <li>Численный (1:1000)</li>
            <li>Именованный (в 1 см 10 м)</li>
            <li>Линейный (графическая шкала)</li>
          </ul>
          <p>Условные знаки:</p>
          <ul>
            <li>Масштабные (леса, здания)</li>
            <li>Внемасштабные (колодцы, деревья)</li>
            <li>Пояснительные (названия)</li>
            <li>Линейные (дороги, реки)</li>
          </ul>
        `,
        examples: [
          {
            problem: "Определите расстояние на местности, если на плане оно составляет 5 см, а масштаб 1:2000",
            solution: "1. Масштаб 1:2000 означает, что 1 см на плане = 2000 см на местности\n2. 5 см × 2000 = 10000 см = 100 м"
          },
          {
            problem: "Какие условные знаки используются для обозначения школы на плане местности?",
            solution: "Школа обозначается внемасштабным условным знаком в виде прямоугольника с буквой 'Шк.' внутри"
          }
        ],
        exercises: [
          {
            problem: "Переведите масштаб 1:5000 в именованный масштаб",
            answer: "1. В 1 см на плане - 5000 см на местности\n2. 5000 см = 50 м\n3. Именованный масштаб: в 1 см 50 м"
          },
          {
            problem: "Определите направление между объектами на плане местности: школа находится к северу от парка, библиотека - к востоку от школы. Где находится библиотека относительно парка?",
            answer: "1. Школа - севернее парка\n2. Библиотека - восточнее школы\n3. Значит, библиотека находится к северо-востоку от парка"
          }
        ]
      }
    },
    "6": {
      "0": {
        theory: `
          <h2>Гидросфера Земли</h2>
          <p>Гидросфера - водная оболочка Земли.</p>
          <p>Состав гидросферы:</p>
          <ul>
            <li>Мировой океан</li>
            <li>Подземные воды</li>
            <li>Ледники</li>
            <li>Реки и озёра</li>
          </ul>
        `,
        examples: [
          {
            problem: "Почему вода в Мировом океане солёная?",
            solution: "1. Растворение минералов из горных пород\n2. Вынос солей реками\n3. Вулканическая деятельность\n4. Жизнедеятельность организмов"
          }
        ],
        exercises: [
          {
            problem: "Рассчитайте, сколько соли содержится в 1 литре морской воды, если солёность составляет 35‰",
            answer: "1. 35‰ означает 35 г соли на 1 кг воды\n2. 1 литр воды ≈ 1 кг\n3. В 1 литре содержится 35 г соли"
          }
        ]
      }
    }
  }
};

const TopicDetails = () => {
  const { subject, grade, topicId } = useParams();
  
  if (!subject || !grade || !topicId || !topics[subject]?.[grade]?.[topicId]) {
    return (
      <div className="min-h-screen bg-gray-50">
        <Navbar />
        <main className="container mx-auto px-4 py-8">
          <Card className="p-6">
            <div className="text-center">
              <h2 className="text-2xl font-bold text-gray-900 mb-2">Тема не найдена</h2>
              <p className="text-gray-600">Извините, запрашиваемая тема не существует или была удалена.</p>
            </div>
          </Card>
        </main>
      </div>
    );
  }

  const content = topics[subject][grade][topicId];

  return (
    <div className="min-h-screen bg-gray-50">
      <Navbar />
      <main className="container mx-auto px-4 py-8">
        <div className="max-w-4xl mx-auto">
          <Card>
            <CardContent className="p-6">
              <Tabs defaultValue="theory" className="w-full">
                <TabsList className="grid w-full grid-cols-3">
                  <TabsTrigger value="theory">Теория</TabsTrigger>
                  <TabsTrigger value="examples">Примеры</TabsTrigger>
                  <TabsTrigger value="exercises">Упражнения</TabsTrigger>
                </TabsList>
                
                <TabsContent value="theory">
                  <div 
                    className="prose max-w-none"
                    dangerouslySetInnerHTML={{ __html: content.theory }} 
                  />
                </TabsContent>

                <TabsContent value="examples">
                  <div className="space-y-6">
                    {content.examples.map((example, index) => (
                      <div key={index} className="bg-white p-4 rounded-lg border">
                        <h3 className="font-semibold mb-2">Пример {index + 1}</h3>
                        <p className="mb-4">{example.problem}</p>
                        <div className="bg-gray-50 p-4 rounded">
                          <p className="font-medium">Решение:</p>
                          <p className="whitespace-pre-line">{example.solution}</p>
                        </div>
                      </div>
                    ))}
                  </div>
                </TabsContent>

                <TabsContent value="exercises">
                  <div className="space-y-6">
                    {content.exercises.map((exercise, index) => (
                      <div key={index} className="bg-white p-4 rounded-lg border">
                        <h3 className="font-semibold mb-2">Упражнение {index + 1}</h3>
                        <p className="mb-4">{exercise.problem}</p>
                        <Button 
                          variant="outline"
                          className="w-full justify-between"
                          onClick={() => {
                            const button = document.getElementById(`answer-${index}`);
                            if (button) {
                              button.textContent = exercise.answer;
                            }
                          }}
                        >
                          <span id={`answer-${index}`}>Показать ответ</span>
                          <CheckCircle2 className="h-4 w-4 ml-2" />
                        </Button>
                      </div>
                    ))}
                  </div>
                </TabsContent>
              </Tabs>
            </CardContent>
          </Card>
        </div>
      </main>
    </div>
  );
};

export default TopicDetails;
